<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>VINMonad — Swap • Dice • Lotto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta
      name="description"
      content="On-chain utilities built on Monad, providing Swap, Dice, and Lotto through publicly verified contracts and an open-source dApp."
    />
    <meta name="theme-color" content="#0b1220" />

    <link rel="icon" type="image/png" href="logo.png" />
    <link rel="stylesheet" href="style.css" />

    <!-- Ethers v5 -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

    <!-- App logic -->
    <script src="app.js" defer></script>
  </head>

  <body>
    <div class="app-shell">
      <!-- TOP NAV -->
      <header class="top-nav">
        <button class="brand" id="navBrand" type="button" aria-label="Go Home">
          <img class="brand-logo" src="logo.png" alt="VIN" />
          <div class="brand-text">
            <div class="brand-title">VINMonad</div>
            <div class="brand-subtitle">Swap • Dice • Lotto</div>
          </div>
        </button>

        <nav class="nav-links" aria-label="Primary">
          <button class="nav-link active" id="navHome" type="button">Home</button>
          <button class="nav-link" id="navSwap" type="button">Swap</button>
          <button class="nav-link" id="navDice" type="button">Dice</button>
          <button class="nav-link" id="navLotto" type="button">Lotto</button>
        </nav>

        <div class="nav-right">
          <div class="price-chip" title="VIN/USD derived from MON/USD">
            <span class="price-label">1 VIN ≈</span>
            <span class="price-value" id="vinUsdChip">Loading...</span>
            <span class="price-label">USD</span>
          </div>

          <div class="network-indicator" title="Network status">
            <span class="dot dot-disconnected" id="networkDot"></span>
            <span class="network-label" id="networkName">Not connected</span>
          </div>

          <button class="btn btn-connect" id="connectBtn" type="button">Connect</button>
        </div>
      </header>

      <!-- MAIN -->
      <main class="main-content">
        <!-- HOME -->
        <section class="screen screen-active" id="home-screen">
          <div class="screen-header compact">
            <h1>Home</h1>
            <p class="screen-subtitle" id="homeSubtitle">
              On-chain utilities on Monad.
            </p>
          </div>

          <div class="grid-2">
            <div class="card">
              <div class="card-title">Wallet</div>

              <div class="kv">
                <div class="kv-row">
                  <span class="kv-k">Address</span>
                  <span class="kv-v" id="walletShort">Not connected</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">VIN Balance</span>
                  <span class="kv-v" id="homeVinBal">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">MON Balance</span>
                  <span class="kv-v" id="homeMonBal">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">Network</span>
                  <span class="kv-v" id="homeNetwork">-</span>
                </div>
              </div>

              <div class="actions-row">
                <button class="btn btn-primary" id="goSwapBtn" type="button">Swap</button>
                <button class="btn btn-secondary" id="goDiceBtn" type="button">Dice</button>
                <button class="btn btn-secondary" id="goLottoBtn" type="button">Lotto</button>
                <button class="btn btn-outline" id="refreshBtn" type="button">Refresh</button>
              </div>

              <div class="hint" id="homeHint">
                Connect your wallet to load balances.
              </div>
            </div>

            <div class="card">
              <div class="card-title">Pools</div>

              <div class="kv">
                <div class="kv-row">
                  <span class="kv-k">Dice Pool (VIN)</span>
                  <span class="kv-v" id="homeDicePool">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">Lotto Pool (VIN)</span>
                  <span class="kv-v" id="homeLottoPool">-</span>
                </div>
              </div>

              <div class="hint">
                Pools are read directly from contracts.
              </div>
            </div>
          </div>
        </section>

        <!-- SWAP -->
        <section class="screen" id="swap-screen">
          <div class="screen-header">
            <h1>Swap</h1>
            <p class="screen-subtitle">VIN ↔ MON</p>
          </div>

          <div class="panel">
            <div class="tabs">
              <button class="tab active" id="swapTabVinToMon" type="button">VIN → MON</button>
              <button class="tab" id="swapTabMonToVin" type="button">MON → VIN</button>
            </div>

            <div class="form">
              <div class="form-row">
                <div class="form-label-row">
                  <span>From</span>
                  <span class="muted" id="swapFromBal">Balance: -</span>
                </div>
                <div class="input-row">
                  <input id="swapFromAmt" type="text" inputmode="decimal" placeholder="0.0" />
                  <button class="chip" id="swapFromToken" type="button" tabindex="-1">VIN</button>
                  <button class="btn-mini" id="swapMaxBtn" type="button">MAX</button>
                </div>
              </div>

              <div class="form-row">
                <div class="form-label-row">
                  <span>To</span>
                  <span class="muted" id="swapToBal">Balance: -</span>
                </div>
                <div class="input-row">
                  <input id="swapToAmt" type="text" placeholder="0.0" readonly />
                  <button class="chip" id="swapToToken" type="button" tabindex="-1">MON</button>
                </div>
              </div>

              <div class="meta-row">
                <div class="muted" id="swapRateLabel">Rate: -</div>
                <div class="muted" id="swapPoolLabel">Pool: -</div>
              </div>

              <div class="actions-row">
                <button class="btn btn-outline" id="swapApproveBtn" type="button">Approve (VIN)</button>
                <button class="btn btn-primary" id="swapBtn" type="button">Swap</button>
              </div>

              <div class="status" id="swapStatus">Waiting for your action...</div>
            </div>
          </div>
        </section>

        <!-- DICE -->
        <section class="screen" id="dice-screen">
          <div class="screen-header">
            <h1>Dice</h1>
            <p class="screen-subtitle">Even / Odd</p>
          </div>

          <div class="grid-2">
            <div class="panel">
              <div class="panel-title">Wallet</div>

              <div class="kv">
                <div class="kv-row">
                  <span class="kv-k">Address</span>
                  <span class="kv-v" id="diceWalletShort">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">VIN Balance</span>
                  <span class="kv-v" id="diceVinBal">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">MON Balance</span>
                  <span class="kv-v" id="diceMonBal">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">Allowance</span>
                  <span class="kv-v" id="diceAllowance">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">Pool (VIN)</span>
                  <span class="kv-v" id="dicePool">-</span>
                </div>
              </div>

              <div class="actions-row">
                <button class="btn btn-outline" id="diceApproveBtn" type="button">Approve (1,000,000 VIN)</button>
                <button class="btn btn-outline" id="diceRefreshBtn" type="button">Refresh</button>
              </div>
            </div>

            <div class="panel">
              <div class="panel-title">Play</div>

              <div class="form">
                <div class="form-row">
                  <div class="form-label-row">
                    <span>Bet Amount (VIN)</span>
                    <span class="muted" id="diceMinMax">MIN: 1 VIN • MAX: 50 VIN</span>
                  </div>
                  <div class="input-row">
                    <input id="diceBetAmt" type="text" inputmode="decimal" placeholder="1" value="1" />
                    <button class="btn-mini" id="diceMaxBtn" type="button">MAX</button>
                  </div>
                </div>

                <div class="choice-row" role="group" aria-label="Dice choice">
                  <button class="choice-btn active" id="diceEvenBtn" type="button">EVEN</button>
                  <button class="choice-btn" id="diceOddBtn" type="button">ODD</button>
                </div>

                <div class="dice-visual" aria-label="Dice visual">
                  <div class="dice-coin dice-coin-white"></div>
                  <div class="dice-coin dice-coin-white"></div>
                  <div class="dice-coin dice-coin-white"></div>
                  <div class="dice-coin dice-coin-white"></div>
                </div>

                <div class="actions-row">
                  <button class="btn btn-primary" id="dicePlayBtn" type="button">Play</button>
                </div>

                <div class="status" id="diceStatus">Waiting for your action...</div>
                <div class="result" id="diceResult">No result yet</div>
              </div>
            </div>
          </div>
        </section>

        <!-- LOTTO -->
        <section class="screen" id="lotto-screen">
          <div class="screen-header">
            <h1>Lotto</h1>
            <p class="screen-subtitle">BetOne / Bet27</p>
          </div>

          <div class="grid-2">
            <div class="panel">
              <div class="panel-title">Wallet</div>

              <div class="kv">
                <div class="kv-row">
                  <span class="kv-k">Address</span>
                  <span class="kv-v" id="lottoWalletShort">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">VIN Balance</span>
                  <span class="kv-v" id="lottoVinBal">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">MON Balance</span>
                  <span class="kv-v" id="lottoMonBal">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">Allowance</span>
                  <span class="kv-v" id="lottoAllowance">-</span>
                </div>
                <div class="kv-row">
                  <span class="kv-k">Pool (VIN)</span>
                  <span class="kv-v" id="lottoPool">-</span>
                </div>
              </div>

              <div class="actions-row">
                <button class="btn btn-outline" id="lottoApproveBtn" type="button">Approve (1,000,000 VIN)</button>
                <button class="btn btn-outline" id="lottoRefreshBtn" type="button">Refresh</button>
              </div>
            </div>

            <div class="panel">
              <div class="panel-title">Place Bet</div>

              <div class="tabs">
                <button class="tab active" id="lottoTabBetOne" type="button">BetOne (x70)</button>
                <button class="tab" id="lottoTabBet27" type="button">Bet27 (x3 per hit)</button>
              </div>

              <div class="form">
                <div class="rows-head">
                  <div class="rows-title">Your Rows</div>
                  <div class="rows-actions">
                    <button class="btn-mini" id="lottoAddRowBtn" type="button">Add Row</button>
                    <button class="btn-mini" id="lottoRemoveRowBtn" type="button">Remove Row</button>
                  </div>
                </div>

                <div class="rows" id="lottoRows">
                  <!-- JS will render rows here -->
                  <div class="row">
                    <div class="row-col">
                      <label class="mini-label">Number (00–99)</label>
                      <input class="lottoNumber" type="text" inputmode="numeric" maxlength="2" placeholder="00" value="00" />
                    </div>
                    <div class="row-col">
                      <label class="mini-label">Bet Amount (VIN)</label>
                      <input class="lottoAmount" type="text" inputmode="decimal" placeholder="1" value="1" />
                    </div>
                  </div>
                </div>

                <div class="quick-row">
                  <button class="btn-mini" id="lottoHalfBtn" type="button">1/2</button>
                  <button class="btn-mini" id="lottoDoubleBtn" type="button">x2</button>
                  <button class="btn-mini" id="lottoClearBtn" type="button">Clear</button>
                </div>

                <div class="meta-row">
                  <div class="muted">Total Bet:</div>
                  <div class="strong" id="lottoTotalBet">-</div>
                </div>

                <div class="actions-row">
                  <button class="btn btn-primary" id="lottoPlayBtn" type="button">Place Bet</button>
                </div>

                <div class="status" id="lottoStatus">Waiting for your action...</div>

                <div class="panel-sub">
                  <div class="panel-sub-title">Your Bet</div>
                  <div class="muted" id="lottoBetSummary">No bet yet</div>
                </div>

                <div class="panel-sub">
                  <div class="panel-sub-title">Result</div>
                  <div class="muted" id="lottoResultSummary">No result yet</div>
                </div>

                <div class="panel-sub">
                  <div class="panel-sub-title">Win / Loss</div>
                  <div class="muted" id="lottoWinLoss">No win/loss yet</div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- FOOTER -->
      <footer class="footer">
        <div class="footer-left">
          <span class="muted">VINMonad • Monad (chainId 143)</span>
        </div>

        <div class="footer-right">
          <a class="footer-link" href="https://t.me/vinmonad" target="_blank" rel="noreferrer">Telegram</a>
          <a class="footer-link" href="https://x.com/vinmonad" target="_blank" rel="noreferrer">X</a>
          <a class="footer-link" href="https://github.com/vinmonad" target="_blank" rel="noreferrer">GitHub</a>

          <span class="footer-sep">•</span>

          <a class="footer-link" href="https://monadvision.com/token/0x038A2f1abe221d403834aa775669169Ef5eb120A" target="_blank" rel="noreferrer">VIN</a>
          <a class="footer-link" href="https://monadvision.com/address/0x73a8C8Bf994A53DaBb9aE707cD7555DFD1909fbB" target="_blank" rel="noreferrer">Swap</a>
          <a class="footer-link" href="https://monadvision.com/address/0xf2b1C0A522211949Ad2671b0F4bF92547d66ef3A" target="_blank" rel="noreferrer">Dice</a>
          <a class="footer-link" href="https://monadvision.com/address/0x17e945Bc2AeB9fcF9eb73DC4e4b8E2AE2962B525" target="_blank" rel="noreferrer">Lotto</a>
        </div>
      </footer>
    </div>

    <!-- VIN/USD chip: keep ONLY here (app.js must not touch this element) -->
    <script>
  (function () {
    const el = document.getElementById("vinUsdChip");
    if (!el) return;

    // Fixed-rate swap: 1 VIN = 100 MON
    // VIN/USD = MON/USD * 100
    const MON_PER_VIN = 100;

    async function fetchMonUsd() {
      // CoinGecko simple price (no API key required)
      const url =
        "https://api.coingecko.com/api/v3/simple/price?ids=monad&vs_currencies=usd";
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error("price_fetch_failed");
      const j = await r.json();
      const monUsd = j && j.monad && j.monad.usd;
      if (typeof monUsd !== "number") throw new Error("price_missing");
      return monUsd;
    }

    async function tick() {
      try {
        el.textContent = "Loading...";
        const monUsd = await fetchMonUsd();

        // ✅ CORRECT calculation
        const vinUsd = monUsd * MON_PER_VIN;

        el.textContent = vinUsd.toFixed(2);
      } catch (e) {
        el.textContent = "—";
      }
    }

    tick();
    setInterval(tick, 30_000);
  })();
</script>

  </body>
</html>
